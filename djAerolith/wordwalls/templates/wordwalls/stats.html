{% extends "base.html" %}
{% load i18n %}
{% block ss %}
    <link href="/static/css/wordwalls/wordwallsCreateTable.css" rel="stylesheet">
    <link href="/static/css/aerolith/bootstrap-datepicker.css" rel="stylesheet">
{% endblock %}
{% block title %}{% trans "Wordwalls - select list" %}{% endblock %}

{% block jquery_js %}{% endblock %}

{% block content %}
<script src="/static/js/aerolith/jquery-1.11.0.min.js"></script>
<script src="/static/lib/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.bundle.min.js"></script>


<div>

    <canvas id="scoresChart" width="400" height="100"></canvas>

</div>

<p>

<div>

    <canvas id="timeChart" width="400" height="100"></canvas>

</div>

</p>

<p>

Lexicon:<br>
<select class="form-control" id="lexicon">
  <option value="1">CSW15</option>
  <option value="4">OWL2</option>
  <option value="6">CSW12</option>
  <option value="7">America</option>
  <option value="8">FISE09</option>
</select>

<p>

Challenges:<br>
<select class="form-control" id="challenge">
  <option value="6">Today's 7's</option>
  <option value="7">Today's 8's</option>
</select>

</p>

<button type="button" class="btn btn-primary" id="dropdown-button">Submit</button>

</p>

<script>

var scoresByDate = {};
var dateArray = [];
var timeRemainingByDate = {};

$( "#dropdown-button" ).click(function() {

    var lexicon = $('#lexicon').val()
    var challenge = $('#challenge').val()

    $.ajax({
          method: "GET",
          url: "/wordwalls/stats/api/" + lexicon + "/" + challenge,
          dataType: 'json'
    })
        .done(function( msg ) {

            for (i = 0; i < msg.length; i++) {
                var x = i;
                var value = msg[i];
                console.log(value);
                scoresByDate[value.Date] = (Number(value.Score) / Number(value.maxScore)) * 100;
                timeRemainingByDate[value.Date] = value.timeRemaining;
                console.log(timeRemainingByDate);
                console.log(scoresByDate);
                dateArray.push(value.Date);
            }

            charts();
        });

function charts () {

    dateArray = dateArray.sort();
    var keys = [];
    scoresSorted = [];
    timeSorted = [];

    for (var key in scoresByDate) {
        if (scoresByDate.hasOwnProperty(key)) {
            keys.push(key);
        }
    }

    keys.sort();
    for (i = 0; i < keys.length; i++) {
        scoresSorted[i] = scoresByDate[keys[i]];
        timeSorted[i] = timeRemainingByDate[keys[i]];
    }

    console.log(timeSorted);

    var ctx = document.getElementById("scoresChart");

    var scoresChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dateArray,

            datasets: [{
                label: 'Score',
                data: scoresSorted,

                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }

    });

    var ctx = document.getElementById("timeChart");

    var timeChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dateArray,

            datasets: [{
                label: 'Time Remaining',
                data: timeSorted,

                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255,99,132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }

    });

}
});


</script>


{% endblock %}